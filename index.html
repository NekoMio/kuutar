<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kuutar</title>
  <style>
    * { box-sizing: border-box; }
    html, body { margin: 0; height: 100%; }
    body {
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #f8fafc, #e2e8f0);
      overflow: hidden;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    .hero {
      position: relative;
      width: 90vw;
      max-width: none;
      transform: rotate(-5deg);
      transition: transform 0.25s ease-out;
    }

    .hero-img {
      position: relative;
      z-index: 10;
      width: 100%;
      display: block;
    }

    .silhouette {
      position: absolute;
      inset: 0;
      /* WebKit prefix for Chrome/Safari; unprefixed for Firefox/Edge */
      -webkit-mask-image: url("./hero-transparent-full.webp");
      mask-image: url("./hero-transparent-4k.webp");
      -webkit-mask-size: contain;
      mask-size: contain;
      -webkit-mask-repeat: no-repeat;
      mask-repeat: no-repeat;
      -webkit-mask-position: center;
      mask-position: center;
      transition: transform 0.3s ease-out;
    }

    .s1 {
      z-index: -1;
      background: oklch(0.81 0.13 351);
    }

    .s2 {
      z-index: -2;
      background: oklch(0.57 0.24 279);
    }

    .motion-btn {
      position: fixed;
      top: 12px;
      left: 12px;
      padding: 10px 14px;
      border: 1px solid rgba(255, 255, 255, 0.35);
      background: rgba(0, 0, 0, 0.35);
      color: #fff;
      border-radius: 999px;
      font-size: 14px;
      backdrop-filter: blur(12px);
      cursor: pointer;
      z-index: 20;
      transition: opacity 0.2s ease;
    }

    .motion-btn.hidden {
      opacity: 0;
      pointer-events: none;
    }

    @media (min-width: 1025px) {
      .motion-btn {
        display: none;
      }
    }

    @media (max-width: 640px) {
      body {
        align-items: flex-start;
      }
      .hero {
        width: 140vw;
        margin-top: 6vh;
      }
    }
  </style>
</head>
<body>
  <button class="motion-btn" id="motion-btn">启用重力感应</button>
  <div class="hero" id="hero">
    <img class="hero-img" src="./hero-transparent-full.webp" alt="Hero" loading="lazy" decoding="async">
    <div class="silhouette s1"></div>
    <div class="silhouette s2"></div>
  </div>

  <script>
    const hero = document.getElementById("hero");
    const s1 = hero.querySelector(".s1");
    const s2 = hero.querySelector(".s2");
    const motionBtn = document.getElementById("motion-btn");

    const clamp = (v, min, max) => Math.max(min, Math.min(max, v));
    const lerp = (a, b, t) => a + (b - a) * t;

    let targetX = 0;
    let targetY = 0;
    let currentX = 0;
    let currentY = 0;

    const update = () => {
      currentX = lerp(currentX, targetX, 0.08);
      currentY = lerp(currentY, targetY, 0.08);

      // Use viewport-based offsets for larger, resolution-independent motion
      hero.style.transform = `rotate(-8deg) translate(${currentX * 5}vw, ${currentY * 3}vw)`;
      s1.style.transform = `translate(${currentX * 7}vw, ${currentY * 4}vw)`;
      s2.style.transform = `translate(${currentX * 12}vw, ${currentY * 8}vw)`;

      requestAnimationFrame(update);
    };

    // Device orientation (mobile) — iOS needs user gesture; Android auto-enables
    let motionEnabled = false;
    const ua = navigator.userAgent || "";
    const isIOS = /iP(ad|hone|od)/.test(ua) || (ua.includes("Mac") && "ontouchend" in document);
    const handleOrientation = (event) => {
      if (!motionEnabled) return;
      const gamma = clamp(event.gamma || 0, -45, 45); // left-right tilt
      const beta = clamp(event.beta || 0, -45, 45);   // front-back tilt
      targetX = gamma / 45 * 0.5;
      targetY = beta / 45 * 0.5;
    };

    const enableMotion = async () => {
      try {
        if (typeof DeviceOrientationEvent !== "undefined" && typeof DeviceOrientationEvent.requestPermission === "function") {
          const res = await DeviceOrientationEvent.requestPermission();
          if (res !== "granted") return;
        }
        window.addEventListener("deviceorientation", handleOrientation, true);
        motionEnabled = true;
        motionBtn.classList.add("hidden");
      } catch (err) {
        console.warn("Device motion unavailable", err);
      }
    };

    if (isIOS) {
      motionBtn.addEventListener("click", enableMotion);
    } else {
      // Android and others: auto enable, hide button
      motionBtn.classList.add("hidden");
      enableMotion();
    }

    hero.addEventListener("pointermove", (e) => {
      const rect = hero.getBoundingClientRect();
      const x = (e.clientX - rect.left) / rect.width;
      const y = (e.clientY - rect.top) / rect.height;
      targetX = clamp(x - 0.5, -0.5, 0.5);
      targetY = clamp(y - 0.5, -0.5, 0.5);
    });

    hero.addEventListener("pointerleave", () => {
      targetX = 0;
      targetY = 0;
    });

    update();
  </script>
</body>
</html>
